import React, { useEffect, useState } from 'react';
import './MatrixDisplay.css';

const ROWS = 16;
const COLS = 60;
const SPEED = 120;

function MatrixDisplay({ text = '' }) {
    const [offset, setOffset] = useState(COLS);  // Bắt đầu từ bên phải
    const [grid, setGrid] = useState([]);
  
    // Cập nhật offset để di chuyển văn bản từ phải qua trái
    useEffect(() => {
        const interval = setInterval(() => {
          setOffset((prev) => (prev - 1 + COLS) % COLS); // Di chuyển liên tục
        }, SPEED);
        return () => clearInterval(interval);
      }, [text]);
      
    useEffect(() => {
      const newGrid = Array.from({ length: ROWS }, () => Array(COLS).fill(false));
  
      // Vẽ các ký tự dựa trên offset
      for (let i = 0; i < text.length; i++) {
        const char = text[i].toUpperCase();
        const x = offset + i * 6;  // Tính toán vị trí cho mỗi ký tự
        if (x >= 0 && x < COLS) {
          drawChar(newGrid, char, x, 5);
        }
      }
      setGrid(newGrid);
    }, [offset, text]);
  

  return (
    <div className="matrix-container">
      {grid.map((row, rowIndex) => (
        <div key={rowIndex} className="matrix-row">
          {row.map((active, colIndex) => (
            <div
              key={colIndex}
              className={`matrix-cell ${active ? 'active' : ''}`}
            />
          ))}
        </div>
      ))}
    </div>
  );
}

const CHAR_MAP = {
    'A': ['01110', '10001', '11111', '10001', '10001'],
    'Ă': ['00100', '11111', '01110', '10001', '10001'],
    'Â': ['01010', '00100', '11111', '10001', '10001'],
    'B': ['11110', '10001', '11110', '10001', '11110'],
    'C': ['01110', '10001', '10000', '10001', '01110'],
    'D': ['11100', '10010', '10001', '10010', '11100'],
    'Đ': ['01110', '00100', '11111', '10001', '01110'],
    'E': ['11111', '10000', '11110', '10000', '11111'],
    'Ê': ['01010', '11111', '10000', '11110', '10000'],
    'G': ['01110', '10000', '10111', '10001', '01110'],
    'H': ['10001', '10001', '11111', '10001', '10001'],
    'I': ['01110', '00100', '00100', '00100', '01110'],
    'K': ['10001', '10010', '11100', '10010', '10001'],
    'L': ['10000', '10000', '10000', '10000', '11111'],
    'M': ['10001', '11011', '10101', '10001', '10001'],
    'N': ['10001', '11001', '10101', '10011', '10001'],
    'O': ['01110', '10001', '10001', '10001', '01110'],
    'Ô': ['01010', '01110', '10001', '10001', '01110'],
    'Ơ': ['00100', '01110', '10001', '10011', '01110'],
    'P': ['11110', '10001', '11110', '10000', '10000'],
    'Q': ['01110', '10001', '10001', '01110', '00011'],
    'R': ['11110', '10001', '11110', '10010', '10001'],
    'S': ['01111', '10000', '01110', '00001', '11110'],
    'T': ['11111', '00100', '00100', '00100', '00100'],
    'U': ['10001', '10001', '10001', '10001', '01110'],
    'Ư': ['10001', '10001', '10001', '10011', '01110'],
    'V': ['10001', '10001', '10001', '01010', '00100'],
    'X': ['10001', '01010', '00100', '01010', '10001'],
    'Y': ['10001', '01010', '00100', '00100', '00100'],
    'Z': ['11111', '00010', '00100', '01000', '11111'],
  
    // Dấu tiếng Việt khác nhau
    'Á': ['00100', '01110', '10001', '11111', '10001'],
    'À': ['00100', '01110', '10001', '11111', '10001'], // có thể vẽ mũ nghiêng trái
    'Ả': ['00100', '01110', '10001', '11111', '10001'], // có thể thêm dấu hỏi
    'Ã': ['01010', '01110', '10001', '11111', '10001'],
    'Ạ': ['01110', '10001', '11111', '10001', '01110'], // dấu nặng ở dưới
  
    'É': ['00100', '11111', '10000', '11110', '10000'],
    'È': ['00100', '11111', '10000', '11110', '10000'],
    'Ẻ': ['01010', '11111', '10000', '11110', '10000'],
    'Ẽ': ['01010', '11111', '10000', '11110', '10000'],
    'Ẹ': ['11111', '10000', '11110', '10000', '11111'],
  
    'Ó': ['00100', '01110', '10001', '10001', '01110'],
    'Ò': ['00100', '01110', '10001', '10001', '01110'],
    'Õ': ['01010', '01110', '10001', '10001', '01110'],
    'Ọ': ['01110', '10001', '10001', '10001', '01110'],
  
    'Ú': ['00100', '10001', '10001', '10001', '01110'],
    'Ù': ['00100', '10001', '10001', '10001', '01110'],
    'Ũ': ['01010', '10001', '10001', '10001', '01110'],
    'Ụ': ['01110', '10001', '10001', '10001', '01110'],
  
    'Y': ['10001', '01010', '00100', '00100', '00100'],
  
    ' ': ['00000', '00000', '00000', '00000', '00000'],
  };
  

// Hàm vẽ ký tự
function drawChar(grid, char, offsetX, offsetY) {
    const map = CHAR_MAP[char] || CHAR_MAP[' '];
    for (let y = 0; y < map.length; y++) {
      const row = map[y];
      for (let x = 0; x < row.length; x++) {
        if (row[x] === '1') {
          const posY = offsetY + y;
          const posX = offsetX + x;
          if (posY >= 0 && posY < ROWS && posX >= 0 && posX < COLS) {
            grid[posY][posX] = true;
          }
        }
      }
    }
  }
  

export default MatrixDisplay;
